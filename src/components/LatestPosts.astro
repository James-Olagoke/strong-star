---
import { getCollection } from 'astro:content';

// Load NON-draft posts, newest first, take top 3
const posts = (await getCollection('blog', ({ data }) => !data.draft))
  .sort((a, b) => +b.data.date - +a.data.date)
  .slice(0, 3);
---

<section class="mt-16">
  <div class="flex items-end justify-between mb-4">
    <h2 class="text-2xl md:text-3xl font-bold">Latest posts</h2>
    <a href="/blog" class="text-indigo-600 hover:text-indigo-500 font-medium">View all →</a>
  </div>

  {posts.length === 0 ? (
    <p class="text-gray-600">No posts yet. Add files in <code class="bg-gray-100 px-1 rounded">src/content/blog/</code>.</p>
  ) : (
    <ul class="grid grid-cols-1 md:grid-cols-3 gap-6">
      {posts.map(({ slug, data }) => (
        <li class="bg-white rounded-xl shadow p-6 hover:shadow-md transition">
          <a href={`/blog/${slug}`} class="block">
            <h3 class="text-lg font-semibold">{data.title}</h3>
            <p class="text-gray-600 mt-1 line-clamp-2">{data.description}</p>
            <p class="text-sm text-gray-400 mt-2">
              {new Date(data.date).toLocaleDateString()}
              {data.tags?.length ? ` · ${data.tags.join(', ')}` : ''}
            </p>
          </a>
        </li>
      ))}
    </ul>
  )}
</section>
